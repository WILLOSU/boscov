generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//
// ğŸ”„ SubstituÃ­mos o antigo model 'User' por 'Usuario'
//    e adicionamos novos campos conforme o modelo lÃ³gico atualizado.
//

model Usuario {
  id                Int           @id @default(autoincrement())
  nome              String
  senha             String
  email             String        @unique
  status            Boolean       @default(true)
  apelido           String?
  dataNascimento    DateTime
  dataCriacao       DateTime      @default(now())
  dataAtualizacao   DateTime      @updatedAt

  tipoUsuarioId     Int           // ğŸ”— Chave estrangeira para TipoUsuario
  tipoUsuario       TipoUsuario   @relation(fields: [tipoUsuarioId], references: [id])

  // ğŸ”— Relacionamento com as AvaliaÃ§Ãµes feitas pelo usuÃ¡rio (1:N)
  avaliacoes        Avaliacao[]
}

//
// âœ… Modelo para representar os tipos de usuÃ¡rios (ex: Admin, Comum, etc.)
//
model TipoUsuario {
  id        Int       @id @default(autoincrement())
  nome      String
  usuarios  Usuario[] // ğŸ”— Um tipo pode estar associado a vÃ¡rios usuÃ¡rios
}

//
// âœ… Modelo Filme conforme especificado no diagrama
//
model Filme {
  id               Int            @id @default(autoincrement())
  nome             String
  diretor          String
  anoLancamento    Int
  duracao          Int
  produtora        String
  classificacao    String
  poster           String?

  // ğŸ”— Um filme pode ter vÃ¡rias avaliaÃ§Ãµes
  avaliacoes       Avaliacao[]

  // ğŸ”— Relacionamento N:N com Genero (via Genero_Filme)
  generos          Genero_Filme[]
}

//
// âœ… Modelo Genero conforme especificado
//
model Genero {
  id         Int             @id @default(autoincrement())
  descricao  String

  // ğŸ”— Relacionamento com Genero_Filme (N:N)
  generosFilmes Genero_Filme[]
}

//
// âœ… Modelo intermediÃ¡rio para representar o N:N entre Filme e Genero
//
model Genero_Filme {
  idGenero   Int
  idFilme    Int

  // ğŸ”— Relacionamentos com as tabelas pai
  genero     Genero @relation(fields: [idGenero], references: [id])
  filme      Filme  @relation(fields: [idFilme], references: [id])

  // ğŸ” Chave composta para evitar duplicidade
  @@id([idGenero, idFilme])
}

//
// âœ… Modelo Avaliacao, ligado a Usuario e Filme (N:1 dos dois lados)
//
model Avaliacao {
  id         Int      @id @default(autoincrement())
  idUsuario  Int
  idFilme    Int
  nota       Int
  comentario String?

  // ğŸ”— RelaÃ§Ãµes com Usuario e Filme
  usuario    Usuario @relation(fields: [idUsuario], references: [id])
  filme      Filme   @relation(fields: [idFilme], references: [id])
}
